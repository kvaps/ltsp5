# /boot/vmlinuz symlinks are generated when "link_in_boot=yes" is specified
# in /etc/kernel-img.conf, which is generated by ltsp-build-client, which
# normally isn't used when ltsp-update-image --cleanup / is called.

if [ -h /boot/vmlinuz ] && [ -h /boot/initrd.img ] && [ -h /boot/nbi.img ]; then
    return 0
fi

# Prefer non-pae kernels, if the user has installed one.
for kernel in \
    $(find "/boot/" -type f -name 'vmlinuz-*' ! -name 'vmlinuz-*-pae' | sort -frV) \
    $(find "/boot/" -type f -name 'vmlinuz-*-pae' | sort -frV)
do
    version=${kernel#/boot/vmlinuz-}
    if [ -f "/boot/initrd.img-$version" ] && [ -f "/boot/nbi.img-$version" ]; then
        ln -sf "$kernel" /boot/vmlinuz
        ln -sf "/boot/initrd.img-$version" /boot/initrd.img
        ln -sf "/boot/nbi.img-$version" /boot/nbi.img
        break
    fi
done
